<!DOCTYPE html>
<html>
<head>
	<title>NES Tile Viewer</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">

	<script type="text/javascript" src="js/main.js"></script>
	<script type="text/javascript" src="js/paintTile.js"></script>

	<script src="js/jquery-3.5.1.slim.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

</head>
<body>

	<div class="container"><div class="row">

		<div style="position: fixed; width: 300px">

			<h2 style="padding-bottom: 5px">
				<!-- <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/NES-Cartridge.jpg/250px-NES-Cartridge.jpg" style="width: 50px;"> -->
				NES Tile Viewer
			</h2>

			<div class="card shadow">
				<div class="card-header">File (*.chr, *.nes, ...)</div>
				<div class="card-body">

					<input type="file" id="fileSelector" style="width: 100%">
				</div>
			</div>

			<div class="card shadow" style="margin-top: 20px">
				<div class="card-header">Color Palette</div>
				<div class="card-body">

					<table><tr>
						<td><button type="button" class="btn btn-light" onclick="shiftColor(1)">◄</button></td>
						<td><input class="colorPalettePicker" type="color" id="colorPicker1" onchange="onColorClicked(1)"></td>
						<td><input class="colorPalettePicker" type="color" id="colorPicker2" onchange="onColorClicked(2)"></td>
						<td><input class="colorPalettePicker" type="color" id="colorPicker3" onchange="onColorClicked(3)"></td>
						<td><input class="colorPalettePicker" type="color" id="colorPicker4" onchange="onColorClicked(4)"></td>
						<td><button type="button" class="btn btn-light" onclick="shiftColor(-1)">►</button></td>
					</tr></table>

					<div class="dropdown" style="padding-top: 10px">
						<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Other colors</button>
						<div id="dropdownOtherColor" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
							
							<!-- FILLED PROGRAMATICALLY -->

						</div>
					</div>
				</div>
			</div>

			<div class="card shadow" style="margin-top: 20px">
				<div class="card-header">Tile Settings</div>
				<div class="card-body">
					<form>
						<div class="form-row">
							<div class="col"><div class="form-group">
								<label for="tilePerRowRange"><span id="tilePerRowLabel" class="badge badge-secondary">16</span> Tiles / Row</label>
								<input type="range" class="form-control-range" id="tilePerRowRange" value="16" min="1" max="24" onchange="updateTilePerRow(this.value)">
							</div></div>
							<div class="col"><div class="form-group">
								<label for="pixelPerTileRange"><span id="pixelPerTileLabel" class="badge badge-secondary">8</span> Pixels / Tile</label>
								<input type="range" class="form-control-range" id="pixelPerTileRange" value="8" min="1" max="16" onchange="updatePixelPerTile(this.value)">
							</div></div>
						</div>
						<div class="form-row">
							<div class="col">
								<div class="form-group">
									<label for="tilePaddingInput"><span id="tilePaddingRange" class="badge badge-secondary">5</span> Tile Padding</label>
									<input type="range" class="form-control-range" id="tilePaddingInput" value="5" min="0" max="20" onchange="updateTilePadding(this.value)">
								</div>
							</div>
							<div class="col">
								<div class="form-group">
									<label for="pixelPaddingInput"><span id="pixelPaddingRange" class="badge badge-secondary">0</span> Pixel Padding</label>
									<input type="range" class="form-control-range" id="pixelPaddingInput" value="0" min="0" max="10" onchange="updatePixelPadding(this.value)">
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>



		<div style="margin-left: 330px">
			<div class="card shadow">
				<div class="card-header">Tiles</div>
				<div class="card-body">
					<canvas id="myCanvas" width="550" height="10"></canvas>
				</div>
			</div>
		</div>

		<div style="margin-left: 330px; position: fixed; right: 20px; width: 250px">
			<div class="card shadow">
				<div class="card-header">Selection</div>
				<div class="card-body">
					<canvas id="previewCanvas" width="200" height="200"></canvas>
					<code class="text-center" id="previewTileHex"></code>
				</div>
			</div>
		</div>

	</div></div>

	<script>

		const fileSelector = document.getElementById('fileSelector');
		fileSelector.addEventListener('change', (event) => {
			const fileList = event.target.files;
			var file = fileList[0];
			loadFileBytes(file)		
		});

		document.getElementById("myCanvas").addEventListener('click', (e) => {
			selectedByteIndex = getTileBytesIndexFromCoordinate(e.layerX, e.layerY);
			updateTilePreviewCanvas();
		});

		document.getElementById("previewCanvas").addEventListener('click', (e) => {
			onPreviewCanvasClicked(e);
		});

		var dropdown = document.getElementById('dropdownOtherColor');
		buildOtherColorPaletteTable(dropdown)		

		// Example 
		const testHexBytes = ["ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff", "ff", "ff", "99", "81", "c3", "e7", "ff", "ff", "ff", "99", "66", "7e", "bd", "db", "e7", "ff", "00", "42", "24", "18", "18", "24", "42", "00", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "ff", "c3", "bd", "bd", "bd", "bd", "c3", "ff"];
		currentBytes = testHexBytes;
		refreshTileViewerCanvas();

	</script>

</body>
</html>